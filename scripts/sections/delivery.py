#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from pathlib import Path

def write_text_file(path: Path, content: str) -> None:
    path.parent.mkdir(parents=True, exist_ok=True)
    with open(path, 'w', encoding='utf-8') as f:
        f.write(content)

def create_section(root: Path, as_template: bool = False) -> None:
    section_path = root / '06_Поставка_и_отчетность'
    
    for subdir in ['дашборды', 'отчеты', 'инструкции_пользователю']:
        (section_path / subdir).mkdir(parents=True, exist_ok=True)
    
    write_text_file(section_path / 'чеклист_передачи.md', """# Чек-лист передачи проекта

## Документация
- [ ] Техническая документация актуализирована
- [ ] Руководство пользователя создано
- [ ] Руководство администратора готово
- [ ] Архитектурная документация передана

## Код и конфигурация
- [ ] Исходный код передан в репозиторий
- [ ] Конфигурационные файлы документированы
- [ ] Скрипты развертывания готовы
- [ ] База данных и миграции переданы

## Тестирование
- [ ] Все тест-кейсы выполнены
- [ ] UAT успешно завершен
- [ ] Нагрузочное тестирование пройдено
- [ ] Безопасность протестирована

## Среды и доступы
- [ ] Продуктивная среда настроена
- [ ] Мониторинг настроен
- [ ] Резервное копирование настроено
- [ ] Доступы переданы администраторам

## Обучение и поддержка
- [ ] Команда поддержки обучена
- [ ] Пользователи прошли обучение
- [ ] Контакты для поддержки определены
- [ ] SLA для поддержки согласованы

## Критерии готовности
- [ ] Все критичные дефекты исправлены
- [ ] Производительность соответствует требованиям
- [ ] Заказчик подписал акт приемки
- [ ] Гарантийные обязательства оформлены
""")
    
    if as_template:
        write_text_file(section_path / 'дашборды/dashboard_specification.md', """# Спецификация дашборда "Аналитика продаж"

## Общее описание
**Цель:** Предоставить руководству оперативную информацию о состоянии продаж
**Пользователи:** Менеджеры по продажам, директор по продажам
**Частота обновления:** Каждые 30 минут

## Структура дашборда

### Верхняя панель (KPI)
1. **Выручка за месяц**
   - Текущее значение
   - % к плану  
   - % к прошлому месяцу
   - Индикатор: зеленый/желтый/красный

2. **Количество сделок**
   - Новые сделки за неделю
   - Закрытые сделки за неделю
   - Конверсия лид → сделка

### Основные графики
1. **Динамика продаж по месяцам**
   - Тип: линейный график
   - Период: последние 12 месяцев
   - Метрики: план vs факт

2. **ТОП-10 клиентов по выручке**
   - Тип: горизонтальная гистограмма
   - Период: текущий месяц
   - Drill-down: детали по клиенту

3. **Воронка продаж**
   - Количество лидов на каждом этапе
   - Конверсия между этапами
   - Средний чек на этапе

### Фильтры
- Период (дата от/до)
- Регион продаж
- Менеджер
- Категория товаров

## Источники данных
- **CRM система:** сделки, клиенты, воронка
- **ERP система:** фактические платежи
- **Плановая система:** плановые показатели

## Требования к производительности
- Загрузка дашборда: не более 5 секунд
- Обновление фильтров: не более 2 секунд
- Экспорт данных: не более 10 секунд
""")
    
    # Добавляем примеры для пустых папок
    if as_template:
        # Примеры инструкций пользователю
        write_text_file(section_path / 'инструкции_пользователю/README.md', """# Инструкции для пользователей

## Назначение
Документация для конечных пользователей системы: руководства, инструкции, FAQ и обучающие материалы.

## Типы документации

### Руководства пользователя
- `user_manual.md` — полное руководство пользователя
- `quick_start_guide.md` — краткое руководство по началу работы
- `admin_guide.md` — руководство администратора
- `troubleshooting.md` — решение типичных проблем

### Обучающие материалы
- `training_materials/` — презентации и материалы для обучения
- `video_tutorials/` — ссылки на видео-инструкции
- `interactive_tutorials/` — интерактивные туториалы
- `certification_program.md` — программа сертификации

### Справочная информация
- `glossary.md` — глоссарий терминов
- `keyboard_shortcuts.md` — горячие клавиши
- `api_reference.md` — справочник по API для продвинутых пользователей
- `integration_guides/` — руководства по интеграции

## Структура руководства пользователя

### 1. Введение
- Назначение системы
- Целевая аудитория
- Системные требования
- Контактная информация поддержки

### 2. Начало работы
- Регистрация и авторизация
- Первый вход в систему
- Настройка профиля
- Обзор интерфейса

### 3. Основные функции
- Пошаговые инструкции
- Скриншоты интерфейса
- Примеры использования
- Типичные сценарии работы

### 4. Расширенные возможности
- Продвинутые функции
- Настройки и конфигурация
- Интеграции с другими системами
- Автоматизация задач

### 5. Решение проблем
- Часто задаваемые вопросы (FAQ)
- Диагностика проблем
- Контакты технической поддержки
- Известные ограничения

## Принципы написания документации

### Ясность и простота
- Используйте простой язык
- Избегайте технического жаргона
- Структурируйте информацию логично
- Добавляйте примеры и иллюстрации

### Актуальность
- Регулярно обновляйте документацию
- Синхронизируйте с релизами продукта
- Собирайте обратную связь от пользователей
- Отслеживайте изменения в интерфейсе

### Доступность
- Поддерживайте разные форматы (PDF, HTML, мобильная версия)
- Обеспечьте поиск по документации
- Создавайте оглавление и индексы
- Используйте понятную навигацию

## Шаблоны документации

### Пошаговая инструкция
**Задача:** [Что нужно сделать]

**Предварительные требования:**
- [Условие 1]
- [Условие 2]

**Шаги:**
1. [Действие 1]
   - Ожидаемый результат: [описание]
   - Скриншот: [ссылка на изображение]

2. [Действие 2]
   - Ожидаемый результат: [описание]
   - Примечание: [дополнительная информация]

**Результат:** [Что получится в итоге]

**Возможные проблемы:**
- Проблема: [описание] → Решение: [как исправить]

### FAQ запись
**Вопрос:** [Формулировка вопроса пользователя]

**Ответ:** [Подробный ответ с пошаговыми инструкциями]

**Связанные темы:**
- [Ссылка на связанную документацию]
- [Ссылка на видео-туториал]

## Процесс создания документации

### Планирование
- [ ] Определение целевой аудитории
- [ ] Анализ пользовательских сценариев
- [ ] Планирование структуры документации
- [ ] Выбор формата и инструментов

### Создание контента
- [ ] Написание текста
- [ ] Создание скриншотов и диаграмм
- [ ] Запись видео-инструкций
- [ ] Создание интерактивных элементов

### Проверка качества
- [ ] Техническая проверка инструкций
- [ ] Проверка на актуальность
- [ ] Тестирование пользователями
- [ ] Корректура и редактирование

### Публикация и поддержка
- [ ] Размещение в доступном месте
- [ ] Настройка системы поиска
- [ ] Сбор обратной связи
- [ ] Регулярное обновление

## Инструменты для создания документации

### Создание контента
- **GitBook** — современная платформа для документации
- **Confluence** — корпоративная wiki
- **Notion** — универсальная платформа
- **GitLab/GitHub Pages** — документация в репозитории

### Создание скриншотов и видео
- **Snagit** — скриншоты с аннотациями
- **CloudApp** — быстрые скриншоты и гифки
- **Loom** — запись экрана и видео-инструкции
- **OBS Studio** — профессиональная запись видео

### Диаграммы и схемы
- **Draw.io** — бесплатные диаграммы
- **Lucidchart** — профессиональные схемы
- **Miro** — интерактивные доски
- **Figma** — дизайн интерфейсов

## Метрики эффективности документации

### Количественные метрики
- Количество просмотров страниц
- Время, проведенное на странице
- Частота использования поиска
- Количество скачиваний

### Качественные метрики
- Оценки пользователей (звездочки, лайки)
- Комментарии и предложения
- Количество обращений в поддержку по темам из документации
- Результаты опросов удовлетворенности

### Показатели успеха
- Снижение количества обращений в техподдержку
- Увеличение самостоятельного решения проблем пользователями
- Положительная обратная связь от пользователей
- Быстрое внедрение новых функций пользователями
""")
        
        # Примеры отчетов
        write_text_file(section_path / 'отчеты/README.md', """# Отчеты и аналитика

## Назначение
Регулярные отчеты о работе системы, бизнес-метриках, производительности и результатах проектов.

## Типы отчетов

### Операционные отчеты
- `daily_reports/` — ежедневные операционные сводки
- `weekly_summaries/` — еженедельные сводки
- `monthly_reviews/` — месячные обзоры
- `quarterly_reports/` — квартальные отчеты

### Аналитические отчеты
- `performance_analysis/` — анализ производительности
- `user_behavior_analysis/` — анализ поведения пользователей
- `business_intelligence/` — бизнес-аналитика
- `predictive_analytics/` — прогнозная аналитика

### Технические отчеты
- `system_health/` — состояние системы
- `security_reports/` — отчеты по безопасности
- `infrastructure_monitoring/` — мониторинг инфраструктуры
- `incident_reports/` — отчеты об инцидентах

### Проектные отчеты
- `project_status/` — статус проектов
- `milestone_reports/` — отчеты по вехам
- `budget_tracking/` — отслеживание бюджета
- `resource_utilization/` — использование ресурсов

## Структура отчета

### Исполнительное резюме
- **Ключевые выводы:** 3-5 основных инсайтов
- **Рекомендации:** конкретные действия
- **Критические проблемы:** требующие немедленного внимания
- **Тренды:** важные изменения за период

### Основные метрики
- **KPI:** ключевые показатели эффективности
- **Тренды:** изменения по сравнению с предыдущим периодом
- **Бенчмарки:** сравнение с целевыми показателями
- **Сегментация:** разбивка по группам/регионам

### Детальный анализ
- **Методология:** как собирались и анализировались данные
- **Ограничения:** что могло повлиять на результаты
- **Дополнительные данные:** вспомогательная информация
- **Приложения:** подробные таблицы и графики

### Рекомендации и следующие шаги
- **Краткосрочные действия:** что сделать в ближайшие 30 дней
- **Среднесрочные планы:** инициативы на 3-6 месяцев
- **Долгосрочная стратегия:** направления развития
- **Ресурсы:** что потребуется для реализации

## Шаблоны отчетов

### Еженедельный операционный отчет
**Период:** [дата начала] - [дата окончания]  
**Подготовил:** [ФИО и роль]  
**Дата:** [дата создания отчета]

#### Ключевые показатели
| Метрика | Текущая неделя | Предыдущая неделя | Изменение |
|---------|----------------|-------------------|-----------|
| Активные пользователи | [число] | [число] | [+/-X%] |
| Количество транзакций | [число] | [число] | [+/-X%] |
| Время отклика системы | [мс] | [мс] | [+/-X%] |
| Доступность системы | [%] | [%] | [+/-X%] |

#### Основные события
- **Достижения:** [список успехов]
- **Проблемы:** [возникшие сложности]
- **Инциденты:** [критические события]
- **Развертывания:** [обновления системы]

#### Планы на следующую неделю
- [ ] [Задача 1]
- [ ] [Задача 2]
- [ ] [Задача 3]

### Месячный аналитический отчет
**Месяц:** [месяц год]  
**Аналитик:** [ФИО]

#### Исполнительное резюме
[2-3 абзаца с ключевыми выводами]

#### Анализ трендов
[Описание основных тенденций с графиками]

#### Сегментный анализ
[Разбивка по пользовательским сегментам, регионам, продуктам]

#### Рекомендации
1. **Краткосрочные (30 дней):**
   - [Рекомендация 1]
   - [Рекомендация 2]

2. **Среднесрочные (3 месяца):**
   - [Рекомендация 1]
   - [Рекомендация 2]

## Автоматизация отчетов

### Инструменты BI
- **Tableau** — визуализация и дашборды
- **Power BI** — корпоративная аналитика
- **Looker** — современная BI платформа
- **Grafana** — мониторинг и алертинг

### Автоматические отчеты
- **Scheduled reports** — регулярная отправка по расписанию
- **Alert-based reports** — отчеты при превышении порогов
- **On-demand reports** — генерация по запросу
- **Interactive dashboards** — самообслуживание пользователей

### Распространение отчетов
- **Email рассылки** — автоматическая отправка заинтересованным лицам
- **Slack/Teams интеграция** — уведомления в корпоративные мессенджеры
- **Web-портал** — централизованный доступ к отчетам
- **Mobile приложения** — мобильный доступ к ключевым метрикам

## Качество данных в отчетах

### Проверки качества
- **Полнота данных:** нет ли пропущенных значений
- **Точность:** соответствуют ли данные реальности
- **Консистентность:** согласованность между источниками
- **Актуальность:** своевременность обновления данных

### Валидация отчетов
- **Peer review:** проверка коллегами
- **Automated checks:** автоматические проверки на аномалии
- **Business validation:** подтверждение бизнес-логики
- **Historical comparison:** сравнение с историческими данными

## Хранение и архивирование

### Организация файлов
```
отчеты/
├── 2024/
│   ├── 01_январь/
│   │   ├── weekly/
│   │   ├── monthly/
│   │   └── ad_hoc/
│   └── 02_февраль/
├── templates/
├── archived/
└── drafts/
```

### Версионирование
- Используйте понятные имена файлов с датами
- Сохраняйте исходные данные для воспроизводимости
- Документируйте изменения в методологии
- Архивируйте старые отчеты согласно политике хранения

## Чек-лист качественного отчета

### Содержание
- [ ] Четко сформулирована цель отчета
- [ ] Данные актуальны и полны
- [ ] Выводы подкреплены фактами
- [ ] Рекомендации конкретны и выполнимы

### Оформление
- [ ] Структура логична и понятна
- [ ] Графики и таблицы читаемы
- [ ] Есть исполнительное резюме
- [ ] Указаны источники данных

### Проверка
- [ ] Проведена техническая проверка расчетов
- [ ] Получена обратная связь от заинтересованных сторон
- [ ] Проверены форматирование и орфография
- [ ] Отчет соответствует корпоративным стандартам
""")
    else:
        # Базовые описания
        write_text_file(section_path / 'инструкции_пользователю/README.md', """# Инструкции пользователю

Здесь размещаются:
- Руководства пользователя
- Инструкции по работе с системой
- FAQ и решение типичных проблем
- Обучающие материалы
""")
        
        write_text_file(section_path / 'отчеты/README.md', """# Отчеты

Здесь размещаются:
- Регулярные операционные отчеты
- Аналитические обзоры
- Отчеты о производительности системы
- Проектные отчеты и статусы
""")
    
    print(f"✅ Создан раздел: 06_Поставка_и_отчетность ({'с примерами' if as_template else 'базовый'})")
